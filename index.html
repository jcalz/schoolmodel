<!DOCTYPE html>
<html>

<head>
  <title>JOE'S LOCAL School model</title>
  <script src="https://code.jquery.com/jquery-2.2.3.min.js">
  </script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js">
  </script>   
  <script src="js/util.js">
  </script>
  <style>
    .school,
    .charter,
    .resources {
      width: 1000px;
      border: 2px solid black;
      background-color: lightyellow;
      margin: 5px;
    }
    .school,
    .charter {
      height: 50px;
    }
    .resources {
      font-size: 15px;
      height: auto;
      overflow: auto;
    }
    .charter {
      background-color: pink;
    }
    .highlight {
      background-color: yellow;
      font-weight: bold;
    }
    .info {
      width: 80px;
      height: 53px;
      margin: 1px;
      white-space: pre-line;
      font-size: 10px;
      float: left;
    }
    .resources .info {
      font-size: inherit;
      font-weight: bold;
    }
    .section {
      float: left;
      width: 28px;
      height: 43px;
      border: 2px solid black;
      background-color: white;
      margin: 1px;
      position: relative;
      font-family: sans-serif;
    }
    .section .student {
      background: url('img/person.svg');
      background-size: 120% 120%;
      background-position: -3px -3px;
      border: none;
      height: 100%;
      width: 100%;
      margin: auto;
      position: absolute;
      display: block;
    }
    .section .grade {
      font-size: 10px;
      margin-top: -7%;
      text-align: left;
      left: 0;
      top: 0;
      position: absolute;
    }
    .section .size {
      font-size: 20px;
      clear: both;
      display: inline-block;
      text-align: center;
      font-weight: bold;
      position: absolute;
      margin: auto;
      bottom: 1%;
      width: 100%;
    }
    .resource {
      float: right;
      width: 20px;
      height: 30px;
      margin: 1px;
    }
    .resource.lost:after {
      background: url('img/nosign.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 2;
      position: absolute;
      width: inherit;
      height: inherit;
      content: "";
    }
    .resourceGroup {
      display: inline-block;
      overflow: auto;
      border: 1px solid black;
      margin: 1px;
      padding: 0px;
      float: right;
      white-space: pre-line;
    }
    .resourceGroup.music .resource {
      background: white url('img/music.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    .resourceGroup.art .resource {
      background: white url('img/art.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    .resourceGroup.library .resource {
      background: white url('img/library.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    .resourceGroup.languages .resource {
      background: white url('img/languages.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    .resourceGroup.physed .resource {
      background: white url('img/physed.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    .resourceGroup.counselor .resource {
      background: white url('img/counselor.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    .resourceGroup.reading .resource {
      background: white url('img/reading.svg') no-repeat;
      background-size: 100% 100%;
      z-index: 1;
    }
    label {
      display: block;
    }
  </style>
</head>

<body>
<!--  <div id="display">
    <div id="district">
      <b>DISTRICT ENROLLMENT BY SCHOOL AND GRADE</b>
      <div class="schools"></div>
      <div class="resources"></div>
      <div id="results">Ready to start</div>
      <div id="districtStats"></div>
    </div>
    <b>ENROLLMENT IN CHARTER SCHOOLS</b>
    <div class="charter" id="charter"></div>
  </div>-->
  <br>
  <button id="go">Advance year</button>
  <button id="restart">Restart</button>
  <br>
  <div id="config">
    <label>School district:
	  <select id="districtSelect"></select>
	</label>
    <label>Number of schools in the district:
      <input data-var="NUMBER_OF_SCHOOLS_IN_DISTRICT">
    </label>
    <label>Initial number of students in the district:
      <input data-var="INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT">
    </label>
    <label>Maximum class size:
      <input data-var="MAXIMUM_CLASS_SIZE">
    </label>
    <label>District yearly teacher salary:
      <input data-var="TEACHER_SALARY">
    </label>
    <label>District yearly funding per student:
      <input data-var="FUNDING_PER_STUDENT">
    </label>
    <label>Number of students leaving for charter per year:
      <input data-var="CHARTER_DRAW_PER_YEAR">
    </label>
  </div>
  <div id="charts">
     <table class="columns">
      <tr> <td><div id="specialistChart" style="border: 1px solid #ccc; width:500px; height:200px"></div></td>
        <td><div id="fundingChart" style="border: 1px solid #ccc; width:500px; height:200px"></div></td>
      </tr>
    </table>
  </div>
  <div id="output">
  </div>
  <script>
    google.charts.load('current', {'packages':['corechart']});
	var chartsLoaded = $.Deferred();
	google.charts.setOnLoadCallback(function(){chartsLoaded.resolve();});
  
    $(function() {
	  
	  $.getJSON('data/districts.json').done(function(districtsObject){
	
	  // make dropdown for districts
	  window.districtsObject = districtsObject;
	  
	  var options = Object.keys(districtsObject).map(function(id){
		  return $('<option>', {value:id}).text(districtsObject[id].districtName);
		});
      options.sort(function(a,b){return compare(a.text(),b.text());});
      options.unshift($('<option>', {value:''}).text('Choose district or enter custom values'));	 
	  
      $('#districtSelect').append(options);
	   
      var currentYear = 0;
	  var unchangingConfig = {
	    // When a student leaves the district for for a charter school, 
		// the district still gets 100% of the student's funding for the first year,
		// and then 25% of the student's funding for the next five years, 
		// before losing funding for thae student altogether after that.
        FUNDING_FRAC_REMOVED_STUDENT: [1, 0.25, 0.25, 0.25, 0.25, 0.25]
	  }	  
      var config = {
	    DISTRICT_CODE: null,
        MAXIMUM_CLASS_SIZE: 23,
        FUNDING_PER_STUDENT: 16336,
        TEACHER_SALARY: 73266,
        INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT: 3318,
        NUMBER_OF_SCHOOLS_IN_DISTRICT: 6,
        CHARTER_DRAW_PER_YEAR: 50
      }
	  
	  // replace with values from query param if present
	  var queryParams = caseInsensitiveQueryParams();	  
	  Object.keys(config).forEach(function(k){
	    var lck = k.toLowerCase();
		if (lck in queryParams) {
		  config[k] = JSON.parse(queryParams[lck][1]);
		}
	  });
	  
      var resourceTypes = {};
      var makeResourceType = function(typeId, typeName) {
        resourceTypes[typeId] = {
          'typeName': typeName,
          'typeId': typeId,
          'getCost': function() {
            return config.TEACHER_SALARY;
          }
        };
      }
      makeResourceType('music', 'Music Teachers');
      makeResourceType('art', 'Art Teachers');
      makeResourceType('library', 'Librarians');
      makeResourceType('languages', 'World Languages Teachers');
      makeResourceType('physed', 'Physical Education Teachers');
      makeResourceType('counselor', 'Counselor Educators');
      makeResourceType('reading', 'Reading Teachers');
      var ensureNumberOfElements = function(desiredNumber, parentElem, childSelector, newChildHtml) {
        var elems = $(parentElem).find(childSelector);
        // trim
        if (elems.length > desiredNumber) {
          elems.slice(desiredNumber).remove();
        } else if (elems.length < desiredNumber) {
          var newElems = $('');
          for (var i = elems.length; i < desiredNumber; i++) {
            newElems = newElems.add(newChildHtml);
          }
          $(parentElem).append(newElems);
        }
        return $(parentElem).find(childSelector);
      }
      var getResource = function(typeId) {
        return {
          'type': resourceTypes[typeId]
        };
      };
      var getGrade = function(schoolName, initialNumberOfStudents, grade) {
        var name = schoolName ? schoolName : "unnamed grade";
        grade = grade ? grade : 0;
        var getName = function() {
          return name;
        };
        var numberOfStudents = initialNumberOfStudents ? initialNumberOfStudents : 0;
        var getNumberOfStudents = function() {
          return numberOfStudents;
        };
        var removeStudents = function(n) {
          if (n > numberOfStudents) n = numberOfStudents;
          numberOfStudents -= n;
          return n;
        };
        var getNumberOfSections = function() {
          return Math.ceil(getNumberOfStudents() / config.MAXIMUM_CLASS_SIZE);
        };
        return {
          getName: getName,
          getNumberOfStudents: getNumberOfStudents,
          removeStudents: removeStudents,
          getNumberOfSections: getNumberOfSections,
        };
      };
      var getCharter = function() {
        var numberOfStudents = [0, 0, 0, 0, 0, 0, 0, 0, 0]; // array index represents grade, kindergarten - 8th grade
        var getNumberOfStudents = function() {
          return numberOfStudents.reduce(add, 0);
        };
        var yearOpened = null;
        var takeStudentsFromDistrict = function(district) {
          if (yearOpened === null) yearOpened = getCurrentYear();
          var yearsSinceOpened = getCurrentYear() - yearOpened;
          if (yearsSinceOpened > 10) return; // only take kids for 10 years?
          // take 60% of students in grade Y (where Y is years since opened)
          var numFromOneGrade = Math.round(0.6 * config.CHARTER_DRAW_PER_YEAR);
          var g;
          if ((0 <= yearsSinceOpened) && (yearsSinceOpened <= 8)) {
            g = yearsSinceOpened;
            numberOfStudents[g] += district.removeStudentsFromGrade(numFromOneGrade, g);
          }
          // take remainder of  students randomly from any grade in the district
          num = 0;
          while (num < (config.CHARTER_DRAW_PER_YEAR - numFromOneGrade)) {
            if (district.getNumberOfStudents() == 0) break;
            g = Math.floor(Math.random() * 9);
            var n = district.removeStudentsFromGrade(1, g);
            numberOfStudents[g] += n;
            num += n;
          }
        };
        var getNumberOfSections = function() {
          var sec = 0;
          for (var g = 0; g < numberOfStudents.length; g++) {
            sec += Math.ceil(numberOfStudents[g] / config.MAXIMUM_CLASS_SIZE);
          }
          return sec;
        }
        return {
          getName: function() {
            return "Charter School";
          },
          getNumberOfStudents: getNumberOfStudents,
          takeStudentsFromDistrict: takeStudentsFromDistrict,
          getNumberOfSections: getNumberOfSections,
          getNumberOfStudentsInGrade: function(g) {
            return numberOfStudents[g];
          }
        };
      }
      var getSchool = function(name, grades) {
        var sumOver = function(fname) {
          return function() {
            var sum = 0;
            for (var i = 0; i < grades.length; i++) {
              sum += grades[i][fname]();
            }
            return sum;
          };
        };
        var getNumberOfStudents = sumOver('getNumberOfStudents');
        return {
          getName: function() {
            return name;
          },
          getNumberOfStudents: getNumberOfStudents,
          getNumberOfSections: sumOver('getNumberOfSections'),
          getNumberOfStudentsInGrade: function(g) {
            return grades[g].getNumberOfStudents();
          },
          removeStudentsFromGrade: function(num, g) {
            return grades[g].removeStudents(num);
          }
        };
      }
      var gradeNames = ['K', '1', '2', '3', '4', '5', '6', '7', '8'];
      var gradeNameHtml = ['K', '1<sup>st</sup>', '2<sup>nd</sup>', '3<sup>rd</sup>', '4<sup>th</sup>',
        '5<sup>th</sup>', '6<sup>th</sup>', '7<sup>th</sup>', '8<sup>th</sup>'
      ]
      var getDistrict = function(numberOfSchools, initialNumberOfStudentsPerSchool) {
        var getNumberOfSchools = function() {
          return numberOfSchools;
        }
        var schools = [];
        for (var i = 0; i < numberOfSchools; i++) {
          var grades = [];
          var numKids = 0;
          var kidsPerGrade = initialNumberOfStudentsPerSchool / gradeNames.length;
          for (var g = 0; g < gradeNames.length; g++) {
            numKids = Math.floor(kidsPerGrade * (g + 1)) - Math.floor(kidsPerGrade * g);
            grades[g] = getGrade("DS#" + (i + 1) + ", " + gradeNames[g], numKids, g);
          }
          schools[i] = getSchool("District School #" + (i + 1), grades);
        }
        var getNumberOfStudents = function() {
          return schools.map(function(x) {
            return x.getNumberOfStudents();
          }).reduce(add, 0);
        };
		var initialNumberOfStudents = getNumberOfStudents();
        var getNumberOfStudentsInGrade = function(g) {
          return schools.map(function(x) {
            return x.getNumberOfStudentsInGrade(g);
          }).reduce(add, 0);
        };
        var getNumberOfSections = function() {
          var n = 0;
          for (var i = 0; i < numberOfSchools; i++) {
            n += schools[i].getNumberOfSections();
          }
          return n;
        };
        var resources = [];
        var addResourceType = function(resourceType) {
          var resource = getResource(resourceType);
          resources.push(resource);
        };
        var getResources = function() {
          var netFunds = getNetAvailableFunds();
          for (var i = 0; i < resources.length; i++) {
            netFunds += resources[i].type.getCost();
          }
          var resourceCosts = 0;
          for (var i = 0; i < resources.length; i++) {
            resourceCosts += resources[i].type.getCost();
            resources[i].exists = (netFunds >= resourceCosts);
          }
          return resources;
        }
		var getResourcesSummary = function() {
		   var res = getResources();
		   var obj = {};
		   //var keys = [];
		   for (var i = 0; i < res.length; i++) {
		     var t = res[i].type.typeId;
			 if (!(t in obj)) {
				obj[t] = {'type':res[i].type.typeName, 'retainedNumber':0, 'initialNumber':0 };
				//keys.push(t);
			}
			obj[t].initialNumber++;
			if (res[i].exists) {obj[t].retainedNumber++;}
			}
			//keys.sort();
			//return keys.map(function(k){return obj[k];});
			return obj;
		}
		
		var getAvailableFundsForResources = function() {
		  var res = getResources();
		  return sum(res.map(function(r){return r.type.getCost();}))+getNetAvailableFunds();
		}
		
        var removedStudents = {};
        var removeStudentsFromGrade = function(num, g) {
          if (!(currentYear in removedStudents)) removedStudents[currentYear] = 0;
          var ret = 0;
          while (ret < num) {
            if (getNumberOfStudentsInGrade(g) == 0) break;
            var school = schools[Math.floor(Math.random() * schools.length)];
            ret += school.removeStudentsFromGrade(1, g);
          }
          removedStudents[currentYear] += ret;
          return ret;
        }
        var getAvailableFunds = function() {
          var funding = 0;
          var status = '';
          status += (getNumberOfStudents() + ' students @ ' + config.FUNDING_PER_STUDENT + ' ea');
          funding += config.FUNDING_PER_STUDENT * getNumberOfStudents();
          for (var i = 0; i < unchangingConfig.FUNDING_FRAC_REMOVED_STUDENT.length; i++) {
            var year = currentYear - i;
            status += (i + 'years ago, frac student is ' + unchangingConfig.FUNDING_FRAC_REMOVED_STUDENT[i]);
            if (year in removedStudents) {
              status += (removedStudents[year] + ' removed');
              funding += config.FUNDING_PER_STUDENT * unchangingConfig.FUNDING_FRAC_REMOVED_STUDENT[i] *
                removedStudents[year];
            }
          }
          status += (getNumberOfSections() + ' sections @ -' + config.TEACHER_SALARY + ' ea');
          funding -= config.TEACHER_SALARY * getNumberOfSections();
          status += (funding);
          //console.log(status);
          return funding;
        };
        var initialAvailableFunds = getAvailableFunds();
        var initialNumberOfSections = getNumberOfSections();
        var getNetAvailableFunds = function() {
          return getAvailableFunds() - initialAvailableFunds;
        };
        var getNumberOfRemovedTeachers = function() {
          var numRemovedSpecialists = getResources().filter(
            function(r) {
              return !r.exists;
            }).length;
          var numRemovedSections = initialNumberOfSections - getNumberOfSections();
          return numRemovedSpecialists + numRemovedSections;
        };
        return {
          schools: schools,
          getNumberOfStudents: getNumberOfStudents,
		  getInitialNumberOfStudents: function(){return initialNumberOfStudents;},
          getNumberOfStudentsInGrade: getNumberOfStudentsInGrade,
          removeStudentsFromGrade: removeStudentsFromGrade,
          getNetAvailableFunds: getNetAvailableFunds,
		  getAvailableFundsForResources: getAvailableFundsForResources,
          getNumberOfSections: getNumberOfSections,
		  getInitialNumberOfSections: function(){return initialNumberOfSections;},
          addResourceType: addResourceType,
          getResources: getResources,
		  getResourcesSummary: getResourcesSummary,
          getNumberOfRemovedTeachers: getNumberOfRemovedTeachers
        };
      };
      var setCurrentYear = function(y) {
        currentYear = y;
      };
      var getCurrentYear = function() {
        return currentYear;
      }

	  var resourceChartObj;
	  var fundingChartObj;
      function setup() {
	  
	    // clear charts
		chartsLoaded.done(function(){
		 resourceChartObj = {};
		 resourceChartObj.numRows = 10;
		resourceChartObj.options = {
			  title: 'Number of specialists',
			  isStacked: true,
			  legend: { position: 'right', alignment: 'end' },
			  vAxis: {
			    viewWindow: {
				  min: 0
				  }
			  },
			  hAxis: {
			    title: 'Year'
			  },
			  chartArea: {
			    left: '5%',
				width: '60%'
		      }
			};
		 resourceChartObj.data = new google.visualization.DataTable();
		 resourceChartObj.data.addColumn('string', 'Year');
		 Object.keys(resourceTypes).sort().forEach(function(t){
		   resourceChartObj.data.addColumn('number', resourceTypes[t].typeName);
		 });		 
		 resourceChartObj.data.addRows(resourceChartObj.numRows);	
		 resourceChartObj.chart = new google.visualization.ColumnChart($('#specialistChart')[0]);

		 fundingChartObj = {};
		 fundingChartObj.numRows = 10;
		 fundingChartObj.options = {
		   title: 'Available funding for specialists',
		   legend: { position: 'none' },
		   vAxis: {
		     viewWindow: {
			   min: 0,
			   max: 0
			 },
			 format: 'short',
		   },
		   hAxis: {
		     title: 'Year'
		   }
		 };
		 fundingChartObj.data = new google.visualization.DataTable();
		 fundingChartObj.data.addColumn('string', 'Year');
		 fundingChartObj.data.addColumn('number', 'Funding');
		 fundingChartObj.data.addColumn({type:'string', role:'tooltip'});
		 fundingChartObj.data.addRows(fundingChartObj.numRows);
		 fundingChartObj.chart = new google.visualization.ColumnChart($('#fundingChart')[0]);
	  });

	  
	   // replace query param with values from config
	    var queryParams = caseInsensitiveQueryParams();
		
		Object.keys(config).forEach(function(k){
		  var lck = k.toLowerCase();
		  queryParams[lck]=[lck,JSON.stringify(config[k])];
		  });
		
		
		history.replaceState(null,"",'?'+$.param(objectMap(queryParams, function(kv){return kv[1];})));
		
		
	  
        var districtSchoolElems = ensureNumberOfElements(config.NUMBER_OF_SCHOOLS_IN_DISTRICT,
          '#district .schools', '.school', '<div class="school"></div>');
        district = getDistrict(config.NUMBER_OF_SCHOOLS_IN_DISTRICT, Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT /
          config.NUMBER_OF_SCHOOLS_IN_DISTRICT));
		window.district = district;
        district.schools.forEach(function(x, i) {
          x.element = districtSchoolElems[i];
        });
        var m = 'music';
        var a = 'art';
        var r = 'library';
        var repeat = function(array, element, times) {
          for (var i = 0; i < times; i++) array.push(element);
        }
        var arr = [];
        repeat(arr, 'languages', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*4/3300));
        repeat(arr, 'art', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*6/3300));
        repeat(arr, 'music', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*12/3300));
        repeat(arr, 'physed', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*7/3300));
        repeat(arr, 'library', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*7/3300));
        repeat(arr, 'counselor', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*12/3300));
        repeat(arr, 'reading', Math.round(config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT*8/3300));
        arrayShuffle(arr);
        arr.forEach(function(x) {
          district.addResourceType(x);
        });
        district.resourceElement = $('#district .resources');
        var charterSchoolElem = $('#charter');
        charter = getCharter('Charter School');
        charter.element = charterSchoolElem;
      };

	  function getStateObject() {
		var state = {};
		state.year = getCurrentYear();
		state.retainedStudents = district.getNumberOfStudents();
		state.initialStudents = district.getInitialNumberOfStudents();
		state.retainedSections = district.getNumberOfSections();
		state.initialSections = district.getInitialNumberOfSections();
		state.spendingChange = (district.getNetAvailableFunds());
		state.availableFundsForSpecialists = (district.getAvailableFundsForResources());
		state.numberOfTeachersLaidOff = district.getNumberOfRemovedTeachers();
		state.specialists = district.getResourcesSummary();
	    return state;
	  }

	  
	  function output() {
		var stateObj = getStateObject();
		chartsLoaded.done(function(){
			
			if (stateObj.year < resourceChartObj.numRows) {
			resourceChartObj.data.setCell(stateObj.year,0,stateObj.year+'');
			Object.keys(resourceTypes).sort().forEach(function(t,i){
			   var retained = 0;
			   if (t in stateObj.specialists) {
			     retained = stateObj.specialists[t].retainedNumber;
			   }
		       resourceChartObj.data.setCell(stateObj.year,i+1,retained);
		 });
			
			}
			resourceChartObj.chart.draw(resourceChartObj.data, resourceChartObj.options);
			
			if (stateObj.year == 0) {
			fundingChartObj.options.vAxis.viewWindow.min =
			stateObj.availableFundsForSpecialists * -1;
			fundingChartObj.options.vAxis.viewWindow.max = stateObj.availableFundsForSpecialists * 1.5;
			}
	
			if (stateObj.year < fundingChartObj.numRows) {
               fundingChartObj.data.setCell(stateObj.year,0,stateObj.year+'');
			   fundingChartObj.data.setCell(stateObj.year,1,stateObj.availableFundsForSpecialists);
			   fundingChartObj.data.setCell(stateObj.year,2,money(stateObj.availableFundsForSpecialists,false));
			}
			fundingChartObj.chart.draw(fundingChartObj.data, fundingChartObj.options);
			
		});
		
		var output = $('#output');
		output.text('');
		println(output[0],'OUTPUT:\n'+JSON.stringify(stateObj, null, 2).replace(/ /g,'\xa0'));
	  }
       
      var charter;
      var district;
      setup();
	  output();
      //drawSchools();
      var year = 0;
      $('#go').click(function() {
        //var results = document.getElementById("results");
        //$(results).text('');
        year++;
        setCurrentYear(year);
        //println(results, 'YEAR ' + year);
        charter.takeStudentsFromDistrict(district);
        //drawSchools();
		output();
      });
      var restart = function() {
        year = 0;
        setCurrentYear(year);
        //var results = document.getElementById("results");
        //$(results).text('');
        //println(results, 'Restarted');
        setup();
		output();
        //drawSchools();
      };
      $('#restart').click(restart);
      $('input[data-var]').change(function() {
        config[$(this).attr('data-var')] = Number($(this).val());
        restart();
      }).each(function() {
        $(this).val(config[$(this).attr('data-var')]);
      });
	  
	  $('#districtSelect').change(function() {
		// set the config values
		districtId = $(this).val();
		config.DISTRICT_CODE = districtId;
		var d = districtsObject[districtId];
		if (d) {
		var totalEnrollment = sum(d.schools.map(function(s){return s.totalEnrollment;}));
        config.MAXIMUM_CLASS_SIZE = d.maxAllowableClassSize,
        config.FUNDING_PER_STUDENT = d.perPupilSpending,
        config.TEACHER_SALARY = d.teacherSalary,
        config.INITIAL_NUMBER_OF_STUDENTS_IN_DISTRICT = totalEnrollment,
        config.NUMBER_OF_SCHOOLS_IN_DISTRICT = d.schools.length,
        config.CHARTER_DRAW_PER_YEAR = 50*Math.ceil(totalEnrollment/3500);
		$('input[data-var]').each(function(){
		  $(this).val(config[$(this).attr('data-var')]);
		});
		}
		restart();
	  }).val(config.DISTRICT_CODE);
	  
	  
    });});
  </script>

</html>
